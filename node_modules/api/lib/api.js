var express = require("express");
var app = express();
var apicache = require('apicache').options({ debug: true }).middleware;
var fs = require("fs");

// Endpoint to get full emoji list per candidate
app.get("/list", apicache('1 minute'), function(request, response){	
	fs.readFile("./list_dump.json", function(err, data){
		if(err) throw err;
		data = JSON.parse(data);
		response.status(200).json(data);
	});
});

// Get latest emoji
app.get("/latest", apicache('30 seconds'), function(request, response){	
	pool.getConnection(function(err, connection){
		connection.query('SELECT id, candidate, emoji, link FROM emoji_counts ORDER BY id DESC LIMIT 10', function(err, rows){ 
			connection.release();
			response.status(200).json(rows);
		});
	});
});

module.exports = app;